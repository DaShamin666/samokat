# üê≥ Docker Guide –¥–ª—è —Ç–µ—Å—Ç–æ–≤ Samokat

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Docker-–æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Samokat.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Docker –∏ Docker Compose:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
docker --version
docker-compose --version
```

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
./run-docker-tests.sh build

# –ó–∞–ø—É—Å–∫ smoke —Ç–µ—Å—Ç–æ–≤
./run-docker-tests.sh smoke
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
|---------|----------|------------------|
| `build` | –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ | ~5-10 –º–∏–Ω |
| `smoke` | –ó–∞–ø—É—Å—Ç–∏—Ç—å smoke —Ç–µ—Å—Ç—ã | ~10 —Å–µ–∫ |
| `regression` | –ó–∞–ø—É—Å—Ç–∏—Ç—å regression —Ç–µ—Å—Ç—ã | ~30 –º–∏–Ω |
| `full` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã | ~45 –º–∏–Ω |
| `parallel` | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ | ~15 –º–∏–Ω |

### –°–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `allure` | –ó–∞–ø—É—Å—Ç–∏—Ç—å Allure —Å–µ—Ä–≤–µ—Ä |
| `clean` | –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ–±—Ä–∞–∑—ã |
| `logs` | –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ |
| `shell` | –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ |

## üõ†Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

### –û–ø—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
# –í—ã–±–æ—Ä –æ–∫—Ä—É–∂–µ–Ω–∏—è
./run-docker-tests.sh smoke --env=dev     # Dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
./run-docker-tests.sh smoke --env=stage   # Stage –æ–∫—Ä—É–∂–µ–Ω–∏–µ

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è pytest
./run-docker-tests.sh full --args='-k test_order -v'

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
./run-docker-tests.sh regression --rebuild

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
./run-docker-tests.sh parallel --env=stage --args='-m smoke' --rebuild
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`:

```bash
# .env —Ñ–∞–π–ª
TEST_ENV=dev
PYTEST_ARGS=-v --tb=short
```

## üê≥ Docker Compose —Å–µ—Ä–≤–∏—Å—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### `samokat-tests`
–ë–∞–∑–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
```bash
docker-compose run --rm samokat-tests
```

#### `samokat-smoke`
–ë—ã—Å—Ç—Ä—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
```bash
docker-compose run --rm samokat-smoke
```

#### `samokat-regression`
–ü–æ–ª–Ω—ã–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
docker-compose run --rm samokat-regression
```

#### `samokat-parallel`
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤)
```bash
docker-compose run --rm samokat-parallel
```

### –°–µ—Ä–≤–∏—Å –æ—Ç—á–µ—Ç–æ–≤

#### `allure-serve`
–í–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Allure –æ—Ç—á–µ—Ç–æ–≤
```bash
# –ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–µ—Ä–∞
docker-compose --profile allure up -d allure-serve

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5050
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ volumes

Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–Ω—Ç–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

```
./allure-results   -> /app/allure-results   # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Allure
./allure-reports   -> /app/allure-reports   # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
./screenshots      -> /app/screenshots      # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ CPU

| –°–µ—Ä–≤–∏—Å | –ü–∞–º—è—Ç—å (–ª–∏–º–∏—Ç) | CPU (–ª–∏–º–∏—Ç) | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|----------------|-------------|--------------|
| `samokat-tests` | 2GB | 1.0 | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| `samokat-parallel` | 4GB | 2.0 | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| `allure-serve` | 512MB | 0.5 | –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤ |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ docker-compose.yml

```yaml
deploy:
  resources:
    limits:
      memory: 2G
      cpus: '1.0'
    reservations:
      memory: 512M
      cpus: '0.5'
```

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ smoke —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
./run-docker-tests.sh smoke

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
./run-docker-tests.sh smoke --args='-k test_order_buttons'

# –û—Ç–ª–∞–¥–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
./run-docker-tests.sh shell
```

### CI/CD
```bash
# –°–±–æ—Ä–∫–∞ –∏ smoke —Ç–µ—Å—Ç—ã
./run-docker-tests.sh build
./run-docker-tests.sh smoke --env=stage

# –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
./run-docker-tests.sh regression --env=stage
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```bash
# –ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–µ—Ä–∞
./run-docker-tests.sh allure

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./run-docker-tests.sh logs
```

## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–±–æ—Ä–∫–æ–π

#### –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤
```bash
# –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
./run-docker-tests.sh clean
./run-docker-tests.sh build
```

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
```bash
# –û—á–∏—Å—Ç–∫–∞ Docker —Å–∏—Å—Ç–µ–º—ã
docker system prune -a --volumes
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤

#### –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
./run-docker-tests.sh shell
playwright install --dry-run
```

#### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å timeout
```bash
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ timeout –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
./run-docker-tests.sh smoke --args='--timeout=60'
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f samokat-tests
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä–Ω–æ–µ)

| –¢–∏–ø —Ç–µ—Å—Ç–æ–≤ | –í—Ä–µ–º—è | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-------|-------------|----------|
| Smoke | ~10 —Å–µ–∫ | ~5 —Å–µ–∫ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã |
| Regression | ~30 –º–∏–Ω | ~15 –º–∏–Ω | –ü–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| Full | ~45 –º–∏–Ω | ~20 –º–∏–Ω | –í—Å–µ —Ç–µ—Å—Ç—ã |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ smoke —Ç–µ—Å—Ç—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤** –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º –∏–ª–∏ –∏–º–µ–Ω–∏
4. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```dockerfile
# –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
RUN useradd -m -u 1001 testuser
USER testuser
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ host networking
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã CPU –∏ –ø–∞–º—è—Ç–∏

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD

### GitHub Actions
```yaml
- name: Run Docker Tests
  run: |
    ./run-docker-tests.sh build
    ./run-docker-tests.sh smoke --env=stage
```

### GitLab CI
```yaml
test:
  script:
    - ./run-docker-tests.sh build
    - ./run-docker-tests.sh regression
```

## üìù –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
./run-docker-tests.sh clean
./run-docker-tests.sh build

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
docker system prune --volumes
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–æ–≤
docker images

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
docker system df
```

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `./run-docker-tests.sh logs`
2. –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `./run-docker-tests.sh shell`
3. –û—á–∏—Å—Ç–∏—Ç–µ –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `./run-docker-tests.sh clean && ./run-docker-tests.sh build`

Made with ‚ù§Ô∏è for Docker containerized testing
